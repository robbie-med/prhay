<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Prhay | Focus on Prayer</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                            950: '#020617',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans KR', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- OneSignal SDK (Placeholder - requires setup) -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>

    <style>
        /* Custom Scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }
        
        /* Card Flip Animation Classes */
        .perspective { perspective: 1000px; }
        .card-inner { transition: transform 0.6s; transform-style: preserve-3d; }
        
        /* Font loading for Korean */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+KR:wght@300;400;700&display=swap');
    </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { 
            Settings, Plus, Trash2, Check, X, RotateCcw, 
            BarChart2, Home, List, Moon, Sun, Globe, 
            Bell, Download, Upload, ChevronRight, ChevronLeft 
        } = lucide;

        // --- Translations ---
        const TRANSLATIONS = {
            en: {
                app_name: "Prhay",
                start_session: "Start Session",
                cards_today: "Cards for today",
                streak: "Day Streak",
                add_new: "Add New Prayer",
                title_placeholder: "What needs prayer?",
                category: "Category",
                frequency: "Frequency",
                save: "Save",
                daily: "Daily",
                weekly: "Weekly",
                monthly: "Monthly",
                categories: {
                    Personal: "Personal",
                    Family: "Family",
                    Church: "Church",
                    World: "World",
                    Work: "Work"
                },
                stats: "Statistics",
                settings: "Settings",
                dark_mode: "Dark Mode",
                language: "Language",
                notifications: "Notifications",
                enable_notify: "Enable Reminders",
                export: "Export Data (JSON)",
                import: "Import Data",
                delete_confirm: "Are you sure you want to delete this?",
                session_complete: "Session Complete",
                session_complete_sub: "You've finished your rotation for now.",
                back_home: "Back Home",
                no_prayers: "No prayers yet. Add one to start!",
                prayed: "Prayed",
                skip: "Skip",
                manage_list: "Manage List",
                filter_all: "All",
                privacy_note: "Data stored locally on your device.",
                last_prayed: "Last prayed:"
            },
            ko: {
                app_name: "프레이 (Prhay)",
                start_session: "기도 시작하기",
                cards_today: "오늘의 기도 카드",
                streak: "연속 일수",
                add_new: "새 기도 제목 추가",
                title_placeholder: "무엇을 위해 기도할까요?",
                category: "카테고리",
                frequency: "빈도",
                save: "저장",
                daily: "매일",
                weekly: "매주",
                monthly: "매월",
                categories: {
                    Personal: "개인",
                    Family: "가족",
                    Church: "교회",
                    World: "열방",
                    Work: "직장/학업"
                },
                stats: "통계",
                settings: "설정",
                dark_mode: "다크 모드",
                language: "언어",
                notifications: "알림",
                enable_notify: "알림 켜기",
                export: "데이터 내보내기 (JSON)",
                import: "데이터 가져오기",
                delete_confirm: "정말 삭제하시겠습니까?",
                session_complete: "기도 완료",
                session_complete_sub: "오늘의 기도 순서를 마쳤습니다.",
                back_home: "홈으로",
                no_prayers: "기도 제목이 없습니다. 추가해주세요!",
                prayed: "기도함",
                skip: "건너뛰기",
                manage_list: "목록 관리",
                filter_all: "전체",
                privacy_note: "데이터는 기기에만 저장됩니다.",
                last_prayed: "마지막 기도:"
            }
        };

        // --- Mock OneSignal Setup (User must replace App ID) ---
        const initOneSignal = () => {
            window.OneSignalDeferred = window.OneSignalDeferred || [];
            window.OneSignalDeferred.push(async function(OneSignal) {
                await OneSignal.init({
                    appId: "7847fc57-03e6-4e9f-9328-a7b6ae48b31e",
                    safari_web_id: "web.onesignal.auto.054b4fc9-febb-45d1-b366-8fc183da0d9e",
                    notifyButton: {
                        enable: true,
                    },
                    allowLocalhostAsSecureOrigin: true,
                });
                console.log("OneSignal initialized");
            });
        };

        // --- Core Application ---
        const App = () => {
            // -- State --
            const [view, setView] = useState('home'); // home, session, manage, stats, settings
            const [prayers, setPrayers] = useState([]);
            const [sessionQueue, setSessionQueue] = useState([]);
            const [currentCardIndex, setCurrentCardIndex] = useState(0);
            const [stats, setStats] = useState({ streak: 0, lastDate: null, history: {} });
            const [settings, setSettings] = useState({
                darkMode: true,
                lang: 'en',
                dailyGoal: 5
            });

            // -- Load / Save Logic --
            useEffect(() => {
                const loadedPrayers = localStorage.getItem('prhay_prayers');
                const loadedStats = localStorage.getItem('prhay_stats');
                const loadedSettings = localStorage.getItem('prhay_settings');

                if (loadedPrayers) setPrayers(JSON.parse(loadedPrayers));
                if (loadedStats) setStats(JSON.parse(loadedStats));
                if (loadedSettings) setSettings(JSON.parse(loadedSettings));
                
                // Initialize OneSignal logic
                initOneSignal();
            }, []);

            useEffect(() => {
                localStorage.setItem('prhay_prayers', JSON.stringify(prayers));
            }, [prayers]);

            useEffect(() => {
                localStorage.setItem('prhay_stats', JSON.stringify(stats));
            }, [stats]);

            useEffect(() => {
                localStorage.setItem('prhay_settings', JSON.stringify(settings));
                if (settings.darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [settings]);

            // -- Icons Helper --
            useEffect(() => {
                lucide.createIcons();
            });

            const t = TRANSLATIONS[settings.lang];

            // -- Logic: Start Session --
            const startSession = () => {
                // Leitner-ish Sort:
                // 1. Filter by due date (frequency)
                // 2. Sort by 'lastPrayed' (oldest first)
                // 3. Take top N (dailyGoal)
                
                const now = new Date();
                const oneDay = 24 * 60 * 60 * 1000;

                const sorted = [...prayers].sort((a, b) => a.lastPrayed - b.lastPrayed);
                
                // Simple filter logic could be expanded
                const due = sorted.filter(p => {
                    if (!p.lastPrayed) return true; // Never prayed
                    const daysSince = (now.getTime() - p.lastPrayed) / oneDay;
                    if (p.frequency === 'daily') return daysSince >= 0.5;
                    if (p.frequency === 'weekly') return daysSince >= 6.5;
                    if (p.frequency === 'monthly') return daysSince >= 29;
                    return true;
                });

                // If not enough due, fill with oldest prayed
                let queue = due.slice(0, settings.dailyGoal);
                if (queue.length < settings.dailyGoal && sorted.length > queue.length) {
                    const remaining = sorted.filter(p => !queue.includes(p));
                    queue = [...queue, ...remaining.slice(0, settings.dailyGoal - queue.length)];
                }

                setSessionQueue(queue);
                setCurrentCardIndex(0);
                setView('session');
            };

            // -- Logic: Mark Prayed --
            const handlePrayed = (id) => {
                const now = new Date().getTime();
                const todayStr = new Date().toISOString().split('T')[0];

                // Update Prayer
                const updatedPrayers = prayers.map(p => 
                    p.id === id ? { ...p, lastPrayed: now, count: (p.count || 0) + 1 } : p
                );
                setPrayers(updatedPrayers);

                // Update Stats (Streak & Heatmap)
                const newHistory = { ...stats.history, [todayStr]: (stats.history[todayStr] || 0) + 1 };
                
                // Simple Streak Logic
                let newStreak = stats.streak;
                if (stats.lastDate !== todayStr) {
                   const yesterday = new Date();
                   yesterday.setDate(yesterday.getDate() - 1);
                   const yesterdayStr = yesterday.toISOString().split('T')[0];
                   
                   if (stats.lastDate === yesterdayStr) {
                       newStreak++;
                   } else if (stats.lastDate !== todayStr) {
                       newStreak = 1; // Reset if gap > 1 day
                   }
                }

                setStats({ ...stats, streak: newStreak, lastDate: todayStr, history: newHistory });
                nextCard();
            };

            const nextCard = () => {
                if (currentCardIndex < sessionQueue.length - 1) {
                    setCurrentCardIndex(prev => prev + 1);
                } else {
                    setView('complete');
                }
            };

            // -- CRUD --
            const addPrayer = (prayer) => {
                const newPrayer = {
                    id: Date.now(),
                    text: prayer.text,
                    category: prayer.category,
                    frequency: prayer.frequency,
                    lastPrayed: 0,
                    createdAt: Date.now()
                };
                setPrayers([newPrayer, ...prayers]);
            };

            const deletePrayer = (id) => {
                if(confirm(t.delete_confirm)) {
                    setPrayers(prayers.filter(p => p.id !== id));
                }
            };

            // --- Component: Navigation ---
            const NavBar = () => (
                <nav className="fixed bottom-0 w-full bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 p-4 flex justify-around items-center z-50">
                    <button onClick={() => setView('home')} className={`p-2 rounded-xl ${view === 'home' ? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-slate-800' : 'text-slate-400'}`}>
                        <Home size={24} />
                    </button>
                    <button onClick={() => setView('manage')} className={`p-2 rounded-xl ${view === 'manage' ? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-slate-800' : 'text-slate-400'}`}>
                        <List size={24} />
                    </button>
                    <button onClick={() => setView('stats')} className={`p-2 rounded-xl ${view === 'stats' ? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-slate-800' : 'text-slate-400'}`}>
                        <BarChart2 size={24} />
                    </button>
                    <button onClick={() => setView('settings')} className={`p-2 rounded-xl ${view === 'settings' ? 'text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-slate-800' : 'text-slate-400'}`}>
                        <Settings size={24} />
                    </button>
                </nav>
            );

            // --- Views ---

            // 1. HOME VIEW
            if (view === 'home') {
                return (
                    <div className="min-h-screen pb-24 flex flex-col items-center justify-center p-6">
                        <div className="mb-8 text-center">
                            <h1 className="text-4xl font-bold tracking-tight mb-2 bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                                {t.app_name}
                            </h1>
                            <p className="text-slate-500 dark:text-slate-400">{t.privacy_note}</p>
                        </div>

                        <div className="w-full max-w-md bg-white dark:bg-slate-900 rounded-3xl p-8 shadow-xl border border-slate-100 dark:border-slate-800 mb-8">
                            <div className="flex justify-between items-center mb-6">
                                <div>
                                    <p className="text-sm text-slate-500 dark:text-slate-400 font-medium uppercase tracking-wider">{t.streak}</p>
                                    <p className="text-3xl font-bold text-slate-800 dark:text-white">{stats.streak} <span className="text-lg font-normal text-slate-400">days</span></p>
                                </div>
                                <div className="h-12 w-12 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center text-blue-600 dark:text-blue-400">
                                    <RotateCcw size={24} />
                                </div>
                            </div>
                            
                            <div className="space-y-4">
                                <div className="flex justify-between text-sm">
                                    <span className="text-slate-600 dark:text-slate-300">{t.cards_today}</span>
                                    <span className="font-semibold">{settings.dailyGoal}</span>
                                </div>
                                <div className="w-full bg-slate-100 dark:bg-slate-800 rounded-full h-2">
                                    <div className="bg-blue-600 h-2 rounded-full" style={{ width: '0%' }}></div>
                                </div>
                            </div>
                        </div>

                        <button 
                            onClick={startSession}
                            disabled={prayers.length === 0}
                            className="w-full max-w-md py-4 bg-blue-600 hover:bg-blue-700 active:scale-95 transition-all text-white rounded-2xl font-bold text-lg shadow-lg shadow-blue-600/20 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                        >
                            {prayers.length > 0 ? t.start_session : t.no_prayers} <ChevronRight size={20} />
                        </button>

                        <NavBar />
                    </div>
                );
            }

            // 2. SESSION VIEW (The Cards)
            if (view === 'session') {
                const currentCard = sessionQueue[currentCardIndex];
                if (!currentCard) return null;

                const progress = ((currentCardIndex) / sessionQueue.length) * 100;

                return (
                    <div className="min-h-screen flex flex-col bg-slate-100 dark:bg-black">
                        {/* Header */}
                        <div className="p-4 flex justify-between items-center">
                            <button onClick={() => setView('home')} className="p-2 text-slate-500 hover:bg-white/10 rounded-full">
                                <X size={24} />
                            </button>
                            <div className="w-32 bg-slate-200 dark:bg-slate-800 rounded-full h-1.5">
                                <div className="bg-blue-600 h-1.5 rounded-full transition-all duration-300" style={{ width: `${progress}%` }}></div>
                            </div>
                            <span className="text-xs font-mono text-slate-500">{currentCardIndex + 1}/{sessionQueue.length}</span>
                        </div>

                        {/* Card Area */}
                        <div className="flex-1 flex flex-col items-center justify-center p-6 relative">
                            <div className="w-full max-w-md aspect-[3/4] bg-white dark:bg-slate-900 rounded-3xl shadow-2xl border border-slate-200 dark:border-slate-800 flex flex-col p-8 relative overflow-hidden transition-all duration-300">
                                {/* Decorative Category Tag */}
                                <div className="absolute top-0 right-0 p-6">
                                    <span className="px-3 py-1 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 text-xs font-bold uppercase tracking-widest rounded-full">
                                        {t.categories[currentCard.category] || currentCard.category}
                                    </span>
                                </div>

                                <div className="flex-1 flex items-center justify-center text-center">
                                    <h2 className="text-2xl md:text-3xl font-bold leading-relaxed break-words">
                                        {currentCard.text}
                                    </h2>
                                </div>

                                <div className="mt-auto pt-6 border-t border-slate-100 dark:border-slate-800">
                                    <p className="text-xs text-slate-400 text-center uppercase tracking-wider">
                                        {t.last_prayed} {currentCard.lastPrayed ? new Date(currentCard.lastPrayed).toLocaleDateString() : 'Never'}
                                    </p>
                                </div>
                            </div>
                        </div>

                        {/* Controls */}
                        <div className="p-8 pb-12 flex gap-4 max-w-md mx-auto w-full">
                            <button 
                                onClick={nextCard}
                                className="flex-1 py-4 bg-slate-200 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-2xl font-semibold hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors"
                            >
                                {t.skip}
                            </button>
                            <button 
                                onClick={() => handlePrayed(currentCard.id)}
                                className="flex-[2] py-4 bg-blue-600 text-white rounded-2xl font-bold text-lg hover:bg-blue-700 shadow-lg shadow-blue-600/20 active:scale-95 transition-transform"
                            >
                                {t.prayed}
                            </button>
                        </div>
                    </div>
                );
            }

            // 3. COMPLETE VIEW
            if (view === 'complete') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 text-center">
                        <div className="w-24 h-24 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center text-green-600 dark:text-green-400 mb-6 animate-bounce">
                            <Check size={48} />
                        </div>
                        <h2 className="text-3xl font-bold mb-2">{t.session_complete}</h2>
                        <p className="text-slate-500 mb-8">{t.session_complete_sub}</p>
                        <button 
                            onClick={() => setView('home')} 
                            className="px-8 py-3 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-xl font-bold hover:opacity-90 transition-opacity"
                        >
                            {t.back_home}
                        </button>
                    </div>
                );
            }

            // 4. MANAGE VIEW
            if (view === 'manage') {
                const [isAdding, setIsAdding] = useState(false);
                const [newText, setNewText] = useState('');
                const [newCat, setNewCat] = useState('Personal');
                const [newFreq, setNewFreq] = useState('daily');

                const handleSubmit = (e) => {
                    e.preventDefault();
                    if (!newText.trim()) return;
                    addPrayer({ text: newText, category: newCat, frequency: newFreq });
                    setNewText('');
                    setIsAdding(false);
                };

                return (
                    <div className="min-h-screen pb-24 bg-slate-50 dark:bg-slate-950 p-4">
                        <header className="flex justify-between items-center mb-6 pt-4">
                            <h2 className="text-2xl font-bold">{t.manage_list}</h2>
                            <button 
                                onClick={() => setIsAdding(!isAdding)} 
                                className="bg-blue-600 text-white p-2 rounded-full shadow-lg hover:bg-blue-700 transition-colors"
                            >
                                {isAdding ? <X size={24} /> : <Plus size={24} />}
                            </button>
                        </header>

                        {isAdding && (
                            <form onSubmit={handleSubmit} className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-xl mb-6 border border-slate-100 dark:border-slate-800 animate-in slide-in-from-top-4 duration-300">
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-slate-500 mb-1">{t.title_placeholder}</label>
                                        <textarea 
                                            value={newText}
                                            onChange={(e) => setNewText(e.target.value)}
                                            className="w-full p-3 bg-slate-50 dark:bg-slate-800 border-none rounded-xl focus:ring-2 focus:ring-blue-500 outline-none text-lg resize-none"
                                            rows="3"
                                            autoFocus
                                        ></textarea>
                                    </div>
                                    <div className="flex gap-4">
                                        <div className="flex-1">
                                            <label className="block text-sm font-medium text-slate-500 mb-1">{t.category}</label>
                                            <select 
                                                value={newCat} 
                                                onChange={(e) => setNewCat(e.target.value)}
                                                className="w-full p-3 bg-slate-50 dark:bg-slate-800 rounded-xl outline-none"
                                            >
                                                {Object.keys(t.categories).map(k => (
                                                    <option key={k} value={k}>{t.categories[k]}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div className="flex-1">
                                            <label className="block text-sm font-medium text-slate-500 mb-1">{t.frequency}</label>
                                            <select 
                                                value={newFreq} 
                                                onChange={(e) => setNewFreq(e.target.value)}
                                                className="w-full p-3 bg-slate-50 dark:bg-slate-800 rounded-xl outline-none"
                                            >
                                                <option value="daily">{t.daily}</option>
                                                <option value="weekly">{t.weekly}</option>
                                                <option value="monthly">{t.monthly}</option>
                                            </select>
                                        </div>
                                    </div>
                                    <button type="submit" className="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700">
                                        {t.save}
                                    </button>
                                </div>
                            </form>
                        )}

                        <div className="space-y-3">
                            {prayers.length === 0 && (
                                <div className="text-center py-10 text-slate-400">
                                    <p>{t.no_prayers}</p>
                                </div>
                            )}
                            {prayers.map(p => (
                                <div key={p.id} className="bg-white dark:bg-slate-900 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 flex justify-between items-start group">
                                    <div>
                                        <div className="flex items-center gap-2 mb-1">
                                            <span className="text-[10px] font-bold uppercase px-2 py-0.5 bg-slate-100 dark:bg-slate-800 text-slate-500 rounded-md">
                                                {t.categories[p.category] || p.category}
                                            </span>
                                            <span className="text-[10px] font-bold uppercase px-2 py-0.5 bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-md">
                                                {p.frequency}
                                            </span>
                                        </div>
                                        <h3 className="font-semibold text-lg leading-tight">{p.text}</h3>
                                    </div>
                                    <button 
                                        onClick={() => deletePrayer(p.id)}
                                        className="text-slate-300 hover:text-red-500 p-2"
                                    >
                                        <Trash2 size={18} />
                                    </button>
                                </div>
                            ))}
                        </div>
                        <NavBar />
                    </div>
                );
            }

            // 5. STATS VIEW
            if (view === 'stats') {
                // Generate heatmap data for last 28 days
                const days = [];
                const today = new Date();
                for (let i = 27; i >= 0; i--) {
                    const d = new Date();
                    d.setDate(today.getDate() - i);
                    const dateStr = d.toISOString().split('T')[0];
                    days.push({
                        date: dateStr,
                        count: stats.history[dateStr] || 0
                    });
                }

                // Breakdown by category
                const catCounts = prayers.reduce((acc, p) => {
                    acc[p.category] = (acc[p.category] || 0) + 1;
                    return acc;
                }, {});

                return (
                    <div className="min-h-screen pb-24 bg-slate-50 dark:bg-slate-950 p-6">
                        <h2 className="text-2xl font-bold mb-6 pt-4">{t.stats}</h2>
                        
                        {/* Heatmap */}
                        <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 mb-6">
                            <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4">Activity (Last 28 Days)</h3>
                            <div className="grid grid-cols-7 gap-2">
                                {days.map(d => (
                                    <div key={d.date} className="flex flex-col items-center">
                                        <div 
                                            className={`w-full aspect-square rounded-md ${
                                                d.count === 0 ? 'bg-slate-100 dark:bg-slate-800' :
                                                d.count < 3 ? 'bg-blue-300 dark:bg-blue-800' :
                                                d.count < 6 ? 'bg-blue-500 dark:bg-blue-600' :
                                                'bg-blue-700 dark:bg-blue-400'
                                            }`}
                                            title={`${d.date}: ${d.count}`}
                                        ></div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Category Breakdown */}
                        <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800">
                            <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wider mb-4">Focus Areas</h3>
                            <div className="space-y-3">
                                {Object.keys(t.categories).map(cat => {
                                    const count = catCounts[cat] || 0;
                                    const total = prayers.length || 1;
                                    const pct = (count / total) * 100;
                                    return (
                                        <div key={cat}>
                                            <div className="flex justify-between text-sm mb-1">
                                                <span>{t.categories[cat]}</span>
                                                <span className="text-slate-500">{count}</span>
                                            </div>
                                            <div className="w-full bg-slate-100 dark:bg-slate-800 rounded-full h-2">
                                                <div 
                                                    className="bg-slate-800 dark:bg-slate-200 h-2 rounded-full" 
                                                    style={{ width: `${pct}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>

                        <NavBar />
                    </div>
                );
            }

            // 6. SETTINGS VIEW
            if (view === 'settings') {
                const exportData = () => {
                    const dataStr = JSON.stringify({ prayers, stats, settings });
                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `prhay_backup_${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                };

                const importData = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.prayers) setPrayers(data.prayers);
                            if (data.stats) setStats(data.stats);
                            if (data.settings) setSettings(data.settings);
                            alert("Import successful!");
                        } catch (err) {
                            alert("Invalid file format.");
                        }
                    };
                    reader.readAsText(file);
                };

                return (
                    <div className="min-h-screen pb-24 bg-slate-50 dark:bg-slate-950 p-6">
                        <h2 className="text-2xl font-bold mb-6 pt-4">{t.settings}</h2>

                        <div className="space-y-6">
                            {/* Visual Section */}
                            <section className="bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden">
                                <div className="p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center">
                                    <div className="flex items-center gap-3">
                                        <div className="p-2 bg-purple-100 dark:bg-purple-900/30 text-purple-600 rounded-lg"><Moon size={20}/></div>
                                        <span className="font-medium">{t.dark_mode}</span>
                                    </div>
                                    <button 
                                        onClick={() => setSettings({...settings, darkMode: !settings.darkMode})}
                                        className={`w-12 h-6 rounded-full p-1 transition-colors ${settings.darkMode ? 'bg-blue-600' : 'bg-slate-300'}`}
                                    >
                                        <div className={`bg-white w-4 h-4 rounded-full shadow-sm transform transition-transform ${settings.darkMode ? 'translate-x-6' : ''}`}></div>
                                    </button>
                                </div>
                                <div className="p-4 flex justify-between items-center">
                                    <div className="flex items-center gap-3">
                                        <div className="p-2 bg-pink-100 dark:bg-pink-900/30 text-pink-600 rounded-lg"><Globe size={20}/></div>
                                        <span className="font-medium">{t.language}</span>
                                    </div>
                                    <select 
                                        value={settings.lang}
                                        onChange={(e) => setSettings({...settings, lang: e.target.value})}
                                        className="bg-slate-100 dark:bg-slate-800 rounded-lg p-2 text-sm outline-none"
                                    >
                                        <option value="en">English</option>
                                        <option value="ko">한국어</option>
                                    </select>
                                </div>
                            </section>

                            {/* Notifications Section */}
                            <section className="bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden">
                                <div className="p-4 flex justify-between items-center">
                                    <div className="flex items-center gap-3">
                                        <div className="p-2 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 rounded-lg"><Bell size={20}/></div>
                                        <span className="font-medium">{t.notifications}</span>
                                    </div>
                                    <button 
                                        onClick={() => {
                                            if(window.OneSignalDeferred) window.OneSignalDeferred.push(os => os.showSlidedownPrompt());
                                        }}
                                        className="text-sm font-bold text-blue-600 hover:underline"
                                    >
                                        {t.enable_notify}
                                    </button>
                                </div>
                            </section>

                            {/* Data Section */}
                            <section className="bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden p-4 space-y-4">
                                <button onClick={exportData} className="w-full flex items-center justify-center gap-2 p-3 bg-slate-100 dark:bg-slate-800 rounded-xl font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                                    <Download size={18} /> {t.export}
                                </button>
                                <label className="w-full flex items-center justify-center gap-2 p-3 bg-slate-100 dark:bg-slate-800 rounded-xl font-medium hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors cursor-pointer">
                                    <Upload size={18} /> {t.import}
                                    <input type="file" onChange={importData} accept=".json" className="hidden" />
                                </label>
                            </section>
                        </div>

                        <NavBar />
                    </div>
                );
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
